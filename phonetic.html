<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>注音符號拼讀遊戲</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', 'Noto Sans TC', sans-serif;
      background-color: #f7f7f7;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .click-tile {
      cursor: pointer;
      user-select: none;
      transition: transform 0.15s, background-color 0.15s, opacity 0.3s;
      border: 2px solid transparent;
    }
    .click-tile:hover {
      transform: scale(1.05);
      background-color: #fcd34d;
    }
    .click-tile.selected {
      opacity: 0.3;
      pointer-events: none;
    }
    .drop-zone {
      border: 3px dashed #9ca3af;
      transition: background-color 0.2s;
      cursor: pointer;
    }
    .drop-zone:hover:not(.completed-answer) {
      background-color: #fef3c7;
    }
    .drop-zone.completed-answer {
      background-color: #3b82f6;
      color: #ffffff;
      border-style: solid;
      border-color: #2563eb;
    }
    #chinese-hint {
      font-size: clamp(3rem, 10vw, 5rem);
    }
    .pinyin-group {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 0.5rem;
    }
    .drop-zone[data-type="tone"] {
      width: 4rem; height: 4rem; font-size: 1.875rem;
    }
    .drop-zone[data-type="initial"], .drop-zone[data-type="final"] {
      width: 6rem; height: 6rem; font-size: 2.25rem;
    }
    @media (min-width: 640px) {
      .drop-zone[data-type="tone"] {
        width: 5rem; height: 5rem; font-size: 3rem;
      }
      .drop-zone[data-type="initial"], .drop-zone[data-type="final"] {
        width: 8rem; height: 8rem; font-size: 3.75rem;
      }
    }
  </style>
</head>
<body class="p-4 sm:p-8">
  <div class="max-w-5xl w-full bg-white shadow-2xl rounded-xl p-6 sm:p-10 border-4 border-yellow-400">
    <h1 class="text-4xl sm:text-5xl font-extrabold text-center text-red-600 mb-6">注音符號點選拼讀</h1>
    <div class="flex justify-between items-center mb-8 border-b-2 pb-4">
      <div class="text-xl sm:text-2xl font-bold text-gray-700">計時器: <span id="timer" class="text-red-500 text-3xl sm:text-4xl ml-2">3:00</span></div>
      <div class="text-xl sm:text-2xl font-bold text-gray-700">分數: <span id="score" class="text-blue-500 text-3xl sm:text-4xl ml-2">0</span></div>
    </div>
    <div id="chinese-hint" class="text-center font-extrabold text-red-700 p-4 bg-white rounded-xl shadow mb-4"></div>
    <div class="flex justify-center">
      <button id="speak-button" class="bg-red-500 text-white p-4 rounded-full shadow-xl hover:bg-red-600 transition transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center">
        <svg id="speaker-icon" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
          <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
        </svg>
        <div id="loading-spinner" class="hidden h-6 w-6 border-4 border-white border-t-transparent rounded-full animate-spin"></div>
      </button>
    </div>
  </div>

  <script>
    const speakButtonEl = document.getElementById('speak-button');
    const speakerIconEl = document.getElementById('speaker-icon');
    const loadingSpinnerEl = document.getElementById('loading-spinner');
    const chineseHintEl = document.getElementById('chinese-hint');

    const sampleSound = 'ㄏㄨˊ ㄉㄧㄝˊ';
    chineseHintEl.textContent = '蝴蝶'; // 測試用文字

    function speakQuestionSound(text) {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'zh-TW';
      utterance.rate = 0.85;
      utterance.pitch = 1;
      utterance.volume = 1;

      speakButtonEl.disabled = true;
      speakerIconEl.classList.add('hidden');
      loadingSpinnerEl.classList.remove('hidden');

      utterance.onend = () => {
        speakButtonEl.disabled = false;
        speakerIconEl.classList.remove('hidden');
        loadingSpinnerEl.classList.add('hidden');
      };

      utterance.onerror = (err) => {
        console.error("SpeechSynthesis 播放錯誤：", err);
        alert("語音播放失敗，請稍後再試。");
        speakButtonEl.disabled = false;
        speakerIconEl.classList.remove('hidden');
        loadingSpinnerEl.classList.add('hidden');
      };

      window.speechSynthesis.speak(utterance);
    }

    speakButtonEl.addEventListener('click', () => {
      speakQuestionSound(sampleSound);
    });
  </script>
</body>
</html>
